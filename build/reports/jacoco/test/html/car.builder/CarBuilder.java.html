<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CarBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">assignment1</a> &gt; <a href="index.source.html" class="el_package">car.builder</a> &gt; <span class="el_source">CarBuilder.java</span></div><h1>CarBuilder.java</h1><pre class="source lang-java linenums">package car.builder;

import car.domain.*;

import java.util.*;

/**
 * Builder for creating valid Car instances with fluent API.
 * Validates all configurations against the selected model.
 */
<span class="fc" id="L11">public class CarBuilder {</span>
    
    private CarModel model;
    private EngineType engine;
    private TransmissionType transmission;
<span class="fc" id="L16">    private Color color = Color.BLACK; // Default color</span>
<span class="fc" id="L17">    private final Set&lt;InteriorFeature&gt; interiorFeatures = EnumSet.noneOf(InteriorFeature.class);</span>
<span class="fc" id="L18">    private final Set&lt;ExteriorFeature&gt; exteriorFeatures = EnumSet.noneOf(ExteriorFeature.class);</span>
<span class="fc" id="L19">    private final Set&lt;SafetyFeature&gt; safetyFeatures = EnumSet.noneOf(SafetyFeature.class);</span>
    
    /**
     * Sets the car model (required).
     * @param model the car model
     * @return this builder
     */
    public CarBuilder withModel(CarModel model) {
<span class="fc bfc" id="L27" title="All 2 branches covered.">        if (model == null) {</span>
<span class="fc" id="L28">            throw new InvalidCarConfigurationException(&quot;Car model cannot be null&quot;);</span>
        }
<span class="fc" id="L30">        this.model = model;</span>
<span class="fc" id="L31">        return this;</span>
    }
    
    /**
     * Sets the engine type (required).
     * @param engine the engine type
     * @return this builder
     */
    public CarBuilder withEngine(EngineType engine) {
<span class="fc bfc" id="L40" title="All 2 branches covered.">        if (engine == null) {</span>
<span class="fc" id="L41">            throw new InvalidCarConfigurationException(&quot;Engine type cannot be null&quot;);</span>
        }
<span class="fc" id="L43">        this.engine = engine;</span>
<span class="fc" id="L44">        return this;</span>
    }
    
    /**
     * Sets the transmission type (required).
     * @param transmission the transmission type
     * @return this builder
     */
    public CarBuilder withTransmission(TransmissionType transmission) {
<span class="fc bfc" id="L53" title="All 2 branches covered.">        if (transmission == null) {</span>
<span class="fc" id="L54">            throw new InvalidCarConfigurationException(&quot;Transmission type cannot be null&quot;);</span>
        }
<span class="fc" id="L56">        this.transmission = transmission;</span>
<span class="fc" id="L57">        return this;</span>
    }
    
    /**
     * Sets the car color (optional, defaults to BLACK).
     * @param color the color
     * @return this builder
     */
    public CarBuilder setColor(Color color) {
<span class="fc bfc" id="L66" title="All 2 branches covered.">        if (color == null) {</span>
<span class="fc" id="L67">            throw new InvalidCarConfigurationException(&quot;Color cannot be null&quot;);</span>
        }
<span class="fc" id="L69">        this.color = color;</span>
<span class="fc" id="L70">        return this;</span>
    }
    
    /**
     * Adds an interior feature (optional).
     * @param feature the interior feature
     * @return this builder
     */
    public CarBuilder addInteriorFeature(InteriorFeature feature) {
<span class="fc bfc" id="L79" title="All 2 branches covered.">        if (feature == null) {</span>
<span class="fc" id="L80">            throw new InvalidCarConfigurationException(&quot;Interior feature cannot be null&quot;);</span>
        }
<span class="fc" id="L82">        this.interiorFeatures.add(feature);</span>
<span class="fc" id="L83">        return this;</span>
    }
    
    /**
     * Adds multiple interior features (optional).
     * @param features the interior features
     * @return this builder
     */
    public CarBuilder addInteriorFeatures(InteriorFeature... features) {
<span class="fc bfc" id="L92" title="All 2 branches covered.">        for (InteriorFeature feature : features) {</span>
<span class="fc" id="L93">            addInteriorFeature(feature);</span>
        }
<span class="fc" id="L95">        return this;</span>
    }
    
    /**
     * Adds an exterior feature (optional).
     * @param feature the exterior feature
     * @return this builder
     */
    public CarBuilder addExteriorFeature(ExteriorFeature feature) {
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">        if (feature == null) {</span>
<span class="nc" id="L105">            throw new InvalidCarConfigurationException(&quot;Exterior feature cannot be null&quot;);</span>
        }
<span class="fc" id="L107">        this.exteriorFeatures.add(feature);</span>
<span class="fc" id="L108">        return this;</span>
    }
    
    /**
     * Adds a sunroof (convenience method).
     * @return this builder
     */
    public CarBuilder withSunroof() {
<span class="fc" id="L116">        return addExteriorFeature(ExteriorFeature.SUNROOF);</span>
    }
    
    /**
     * Sets the rim type.
     * @param sportRims true for sport rims, false for standard
     * @return this builder
     */
    public CarBuilder withRims(boolean sportRims) {
<span class="fc bfc" id="L125" title="All 2 branches covered.">        return addExteriorFeature(sportRims ? ExteriorFeature.SPORT_RIMS : ExteriorFeature.STANDARD_RIMS);</span>
    }
    
    /**
     * Adds a safety feature (optional).
     * @param feature the safety feature
     * @return this builder
     */
    public CarBuilder addSafetyFeature(SafetyFeature feature) {
<span class="fc bfc" id="L134" title="All 2 branches covered.">        if (feature == null) {</span>
<span class="fc" id="L135">            throw new InvalidCarConfigurationException(&quot;Safety feature cannot be null&quot;);</span>
        }
<span class="fc" id="L137">        this.safetyFeatures.add(feature);</span>
<span class="fc" id="L138">        return this;</span>
    }
    
    /**
     * Adds multiple safety features (optional).
     * @param features the safety features
     * @return this builder
     */
    public CarBuilder addSafetyFeatures(SafetyFeature... features) {
<span class="fc bfc" id="L147" title="All 2 branches covered.">        for (SafetyFeature feature : features) {</span>
<span class="fc" id="L148">            addSafetyFeature(feature);</span>
        }
<span class="fc" id="L150">        return this;</span>
    }
    
    /**
     * Builds and validates the car configuration.
     * @return a valid, immutable Car instance
     * @throws InvalidCarConfigurationException if validation fails
     */
    public Car build() {
<span class="fc" id="L159">        validateRequiredFields();</span>
<span class="fc" id="L160">        validateCompatibility();</span>
        
<span class="fc" id="L162">        return new Car(model, engine, transmission, color, </span>
                interiorFeatures, exteriorFeatures, safetyFeatures);
    }
    
    private void validateRequiredFields() {
<span class="fc" id="L167">        List&lt;String&gt; missingFields = new ArrayList&lt;&gt;();</span>
        
<span class="fc bfc" id="L169" title="All 2 branches covered.">        if (model == null) {</span>
<span class="fc" id="L170">            missingFields.add(&quot;model&quot;);</span>
        }
<span class="fc bfc" id="L172" title="All 2 branches covered.">        if (engine == null) {</span>
<span class="fc" id="L173">            missingFields.add(&quot;engine&quot;);</span>
        }
<span class="fc bfc" id="L175" title="All 2 branches covered.">        if (transmission == null) {</span>
<span class="fc" id="L176">            missingFields.add(&quot;transmission&quot;);</span>
        }
        
<span class="fc bfc" id="L179" title="All 2 branches covered.">        if (!missingFields.isEmpty()) {</span>
<span class="fc" id="L180">            throw new InvalidCarConfigurationException(</span>
<span class="fc" id="L181">                    &quot;Missing required fields: &quot; + String.join(&quot;, &quot;, missingFields) + </span>
                    &quot;. Please specify: withModel(), withEngine(), and withTransmission().&quot;);
        }
<span class="fc" id="L184">    }</span>
    
    private void validateCompatibility() {
<span class="fc" id="L187">        List&lt;String&gt; errors = new ArrayList&lt;&gt;();</span>
        
        // Validate engine compatibility
<span class="fc bfc" id="L190" title="All 2 branches covered.">        if (!model.supportsEngine(engine)) {</span>
<span class="fc" id="L191">            errors.add(String.format(&quot;Engine '%s' is not supported by %s. Allowed engines: %s&quot;,</span>
<span class="fc" id="L192">                    engine.getDisplayName(), </span>
<span class="fc" id="L193">                    model.getDisplayName(),</span>
<span class="fc" id="L194">                    model.getAllowedEngines()));</span>
        }
        
        // Validate transmission compatibility
<span class="fc bfc" id="L198" title="All 2 branches covered.">        if (!model.supportsTransmission(transmission)) {</span>
<span class="fc" id="L199">            errors.add(String.format(&quot;Transmission '%s' is not supported by %s. Allowed transmissions: %s&quot;,</span>
<span class="fc" id="L200">                    transmission.getDisplayName(),</span>
<span class="fc" id="L201">                    model.getDisplayName(),</span>
<span class="fc" id="L202">                    model.getAllowedTransmissions()));</span>
        }
        
        // Validate interior features compatibility
<span class="fc bfc" id="L206" title="All 2 branches covered.">        for (InteriorFeature feature : interiorFeatures) {</span>
<span class="fc bfc" id="L207" title="All 2 branches covered.">            if (!model.supportsInteriorFeature(feature)) {</span>
<span class="fc" id="L208">                errors.add(String.format(&quot;Interior feature '%s' is not supported by %s. Allowed features: %s&quot;,</span>
<span class="fc" id="L209">                        feature.getDisplayName(),</span>
<span class="fc" id="L210">                        model.getDisplayName(),</span>
<span class="fc" id="L211">                        model.getAllowedInteriorFeatures()));</span>
            }
<span class="fc" id="L213">        }</span>
        
        // Validate exterior features compatibility
<span class="fc bfc" id="L216" title="All 2 branches covered.">        for (ExteriorFeature feature : exteriorFeatures) {</span>
<span class="fc bfc" id="L217" title="All 2 branches covered.">            if (!model.supportsExteriorFeature(feature)) {</span>
<span class="fc" id="L218">                errors.add(String.format(&quot;Exterior feature '%s' is not supported by %s. Allowed features: %s&quot;,</span>
<span class="fc" id="L219">                        feature.getDisplayName(),</span>
<span class="fc" id="L220">                        model.getDisplayName(),</span>
<span class="fc" id="L221">                        model.getAllowedExteriorFeatures()));</span>
            }
<span class="fc" id="L223">        }</span>
        
        // Validate safety features compatibility
<span class="fc bfc" id="L226" title="All 2 branches covered.">        for (SafetyFeature feature : safetyFeatures) {</span>
<span class="fc bfc" id="L227" title="All 2 branches covered.">            if (!model.supportsSafetyFeature(feature)) {</span>
<span class="fc" id="L228">                errors.add(String.format(&quot;Safety feature '%s' is not supported by %s. Allowed features: %s&quot;,</span>
<span class="fc" id="L229">                        feature.getDisplayName(),</span>
<span class="fc" id="L230">                        model.getDisplayName(),</span>
<span class="fc" id="L231">                        model.getAllowedSafetyFeatures()));</span>
            }
<span class="fc" id="L233">        }</span>
        
<span class="fc bfc" id="L235" title="All 2 branches covered.">        if (!errors.isEmpty()) {</span>
<span class="fc" id="L236">            throw new InvalidCarConfigurationException(</span>
<span class="fc" id="L237">                    &quot;Invalid car configuration:\n- &quot; + String.join(&quot;\n- &quot;, errors));</span>
        }
<span class="fc" id="L239">    }</span>
    
    /**
     * Resets the builder to initial state.
     * @return this builder
     */
    public CarBuilder reset() {
<span class="fc" id="L246">        this.model = null;</span>
<span class="fc" id="L247">        this.engine = null;</span>
<span class="fc" id="L248">        this.transmission = null;</span>
<span class="fc" id="L249">        this.color = Color.BLACK;</span>
<span class="fc" id="L250">        this.interiorFeatures.clear();</span>
<span class="fc" id="L251">        this.exteriorFeatures.clear();</span>
<span class="fc" id="L252">        this.safetyFeatures.clear();</span>
<span class="fc" id="L253">        return this;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>